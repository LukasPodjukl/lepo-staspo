<!DOCTYPE html>
<html lang="en">

<style>
    table,
    th,
    td {
        border: 1px solid black;
        border-collapse: collapse;
        padding-right: 30px;
    }
</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mincovka</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
</head>

<body>
    <h1>Mincovka</h1>
    <input type="file" id="upload" />
    <pre id="output"></pre>
    <script>
        document.getElementById('upload').addEventListener('change', async function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async function (e) {
                    const arrayBuffer = e.target.result;
                    const workbook = new ExcelJS.Workbook();
                    await workbook.xlsx.load(arrayBuffer);

                    const worksheet = workbook.getWorksheet(1);
                    let output = '';

                    const cols = ["ID", "X", "1000", "500", "200", "100", "50", "20", "10", "5", "2", "1"];

                    var table = document.createElement('table');

                    var tr = document.createElement('tr');
                    for (const col of cols) {
                        var th = document.createElement('th');
                        th.textContent = col;
                        tr.appendChild(th);
                    }
                    table.appendChild(tr);

                    worksheet.eachRow({ includeEmpty: true }, function (row, rowNumber) {
                        if (row.getCell('N').result != null && row.getCell('N').result != 0) {
                            if (row.getCell('A').value != null) {
                                var tr = document.createElement('tr');
                                var x = Math.round(row.getCell('N').result)
                                var temp = x;
                                for (let i = 0; i < cols.length; i++) {
                                    if (cols[i] === "ID") {
                                        var td = document.createElement('td');
                                        td.textContent = `${row.getCell('B').value} [${row.getCell('A').value}]`;
                                        tr.appendChild(td);
                                    } else if (cols[i] === "X") {
                                        var td = document.createElement('td');
                                        td.textContent = x;
                                        tr.appendChild(td);
                                    } else {
                                        var tempMod = temp % cols[i];
                                        console.log(tempMod);
                                        var td = document.createElement('td');
                                        td.textContent = (temp - tempMod) / cols[i];
                                        tr.appendChild(td);
                                        temp = tempMod;
                                    }
                                }
                                table.appendChild(tr);
                            }
                        }
                    });
                    document.getElementById('output').appendChild(table);
                };
                reader.readAsArrayBuffer(file);
            }
        });
    </script>
</body>

</html>